<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="keywords" content="hexo,个人博客,blog" />
  <meta name="description" content="某某的个人博客" />
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="dns-prefetch" href="https://busuanzi.ibruce.info">
  <link rel="dns-prefetch" href="https://at.alicdn.com">
  
  <link rel="dns-prefetch" href="https://widget.daovoice.io">
  <link rel="dns-prefetch" href="https://widget-static-cdn.daovoice.io">
  <link rel="dns-prefetch" href="https://im.daovoice.io">
  
  
  <link rel="dns-prefetch" href="https://hm.baidu.com/">
  
  
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://api.github.com">
  <link rel="dns-prefetch" href="https://avatars3.githubusercontent.com">
  
  <link rel="stylesheet" type="text/css" href="/yearn/./style/main.css">
	<link rel="shortcut icon" href="/favicon.ico" title="Favicon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
	<title>Codeforces Round #172 (Div. 1) - D</title>
  
  <script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?awwssw1snsnsnn1ndndnndnd99j";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();
  </script>
  
  
    <script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/123456.js","daovoice");daovoice('init',{app_id: "123456"});daovoice('update');
  </script>
  
<meta name="generator" content="Hexo 6.3.0"></head>
<body>
  <canvas id="pattern-placeholder" height="230"></canvas>
<div class="navbar-header">
  <a class="blog-title" href="/yearn/">Believe it</a>
  <a class="face-img" href="/yearn/">
    <img src="https://tva3.sinaimg.cn/crop.0.0.200.200.180/005Kc3C1jw8f2uep0hhkvj305k05k3yk.jpg">
  </a>
</div>
<main>
  <div class="article-title">
    
  
  <h1 class="title">
    Codeforces Round #172 (Div. 1) - D
  </h1>
  


    <ul class="article-info">
      <li>
        发布
        <time datetime="2019-08-09T09:15:19.000Z" itemprop="datePublished">2019-08-09</time>
      </li>
      <li>
        
    更新 <time datetime="2019-08-09T09:15:19.000Z" itemprop="dateUpdated">2019-08-09</time>

      </li>
      <li id="busuanzi_container_page_pv">
        阅读 <span id="busuanzi_value_page_pv"></span>
      </li>
    </ul>
  </div>
  <div class="container">
    <div class="article">
      <div class="content">
        
        <div><a href="/next/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">next</a><a href="/hexonext/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">hexonext</a><a href="/butterfly/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">butterfly</a><a href="/volantis/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">volantis</a><a href="/yearn/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">yearn</a><a href="/yilia/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">yilia</a><a href="/shoka/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">shoka</a><a href="/indigo/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">indigo</a><a href="/apollo/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">apollo</a><a href="/landscape/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">landscape</a><a href="/cactus/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">cactus</a><a href="/matery/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">matery</a><a href="/icarus/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">icarus</a><a href="/fluid/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">fluid</a><a href="/material/PVYPPJ.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">material</a><div style="clear: both;"></div></div>

<h1 id="name"><a href="#name" class="headerlink" title="name"></a>name</h1><p>k-Maximum Subsequence Sum</p>
<h1 id="descirption"><a href="#descirption" class="headerlink" title="descirption"></a>descirption</h1><p>time limit per test 4 seconds<br>memory limit per test 256 megabytes<br>Consider integer sequence $a_1, a_2, …, a_n$. You should run queries of two types:<br>The query format is “0 i val”. In reply to this query you should make the following assignment: $a_i$ &#x3D; val.<br>The query format is “1 l r k”. In reply to this query you should print the maximum sum of at most k non-intersecting subsegments of sequence $a_l, a_{l + 1}, …, a_r$. Formally, you should choose at most k pairs of integers $(x_1, y_1), (x_2, y_2), …, (x_t, y_t) (l ≤ x_1 ≤ y_1 &lt; x_2 ≤ y_2 &lt; … &lt; x_t ≤ y_t ≤ r; t ≤ k)$ such that the sum $a_{x_1<br>} + a_{x_1 + 1} + … + a_{y_1} + a_{x_2} + a_{x_2 + 1} + … + a_{y_2} + … + a_{x_t} + a_{x_t + 1} + … + a_{y_t}$ is as large as possible. Note that you should choose at most k subsegments. Particularly, you can choose 0 subsegments. In this case the described sum considered equal to zero</p>
<!---more-->

<h1 id="input"><a href="#input" class="headerlink" title="input"></a>input</h1><p>The first line contains integer $n (1 ≤ n ≤ 10^5)$, showing how many numbers the sequence has. The next line contains n integers a1, a2, …, an (|ai| ≤ 500).<br>The third line contains integer $m (1 ≤ m ≤ 10^5)$ — the number of queries. The next m lines contain the queries in the format, given in the statement.<br>All changing queries fit into limits: 1 ≤ i ≤ n, |val| ≤ 500.<br>All queries to count the maximum sum of at most k non-intersecting subsegments fit into limits: 1 ≤ l ≤ r ≤ n, 1 ≤ k ≤ 20. It is guaranteed that the number of the queries to count the maximum sum of at most k non-intersecting subsegments doesn’t exceed 10000.</p>
<h1 id="output"><a href="#output" class="headerlink" title="output"></a>output</h1><p>For each query to count the maximum sum of at most k non-intersecting subsegments print the reply — the maximum sum. Print the answers to the queries in the order, in which the queries follow in the input.</p>
<h1 id="sample-input"><a href="#sample-input" class="headerlink" title="sample input"></a>sample input</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">9</span><br><span class="line">9 -8 9 -1 -1 -1 9 -8 9</span><br><span class="line">3</span><br><span class="line">1 1 9 1</span><br><span class="line">1 1 9 2</span><br><span class="line">1 4 6 3</span><br></pre></td></tr></table></figure>



<h1 id="sample-output"><a href="#sample-output" class="headerlink" title="sample output"></a>sample output</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">17</span><br><span class="line">25</span><br><span class="line">0</span><br></pre></td></tr></table></figure>



<h1 id="sample-input-1"><a href="#sample-input-1" class="headerlink" title="sample input"></a>sample input</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">15</span><br><span class="line">-4 8 -3 -10 10 4 -7 -7 0 -6 3 8 -10 7 2</span><br><span class="line">15</span><br><span class="line">1 3 9 2</span><br><span class="line">1 6 12 1</span><br><span class="line">0 6 5</span><br><span class="line">0 10 -7</span><br><span class="line">1 4 9 1</span><br><span class="line">1 7 9 1</span><br><span class="line">0 10 -3</span><br><span class="line">1 4 10 2</span><br><span class="line">1 3 13 2</span><br><span class="line">1 4 11 2</span><br><span class="line">0 15 -9</span><br><span class="line">0 13 -9</span><br><span class="line">0 11 -10</span><br><span class="line">1 5 14 2</span><br><span class="line">1 6 12 1</span><br></pre></td></tr></table></figure>



<h1 id="sample-output-1"><a href="#sample-output-1" class="headerlink" title="sample output"></a>sample output</h1><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">14</span><br><span class="line">11</span><br><span class="line">15</span><br><span class="line">0</span><br><span class="line">15</span><br><span class="line">26</span><br><span class="line">18</span><br><span class="line">23</span><br><span class="line">8</span><br></pre></td></tr></table></figure>



<h1 id="hint"><a href="#hint" class="headerlink" title="hint"></a>hint</h1><p>In the first query of the first example you can select a single pair (1, 9). So the described sum will be 17.</p>
<p>Look at the second query of the first example. How to choose two subsegments? (1, 3) and (7, 9)? Definitely not, the sum we could get from (1, 3) and (7, 9) is 20, against the optimal configuration (1, 7) and (9, 9) with 25.</p>
<p>The answer to the third query is 0, we prefer select nothing if all of the numbers in the given interval are negative.</p>
<h1 id="toturial"><a href="#toturial" class="headerlink" title="toturial"></a>toturial</h1><p>先考虑k&#x3D;1的情况, 我么你可以直接用线段树来维护，这是一个经典问题，但是当k&gt;1的时候，我们可以这样来做，我们做k次下诉操作，取出最大字段和，然后将这一段数乘以-1，直到最大字段和为负或者执行了k次操作，如此我们就能得到最大k字段和。正确性可以用费用流来证明。</p>
<h1 id="code"><a href="#code" class="headerlink" title="code"></a>code</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i,j,k) for(int i=(j);i&lt;=(k);i++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ml ((l+r)&gt;&gt;1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mr (ml+1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">swap2</span><span class="params">(<span class="type">int</span>&amp;a,<span class="type">int</span>&amp;b)</span></span>&#123;a*=<span class="number">-1</span>;b*=<span class="number">-1</span>;<span class="built_in">swap</span>(a,b);&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sub</span>&#123;</span><br><span class="line">    <span class="type">int</span> maxl,maxlat;</span><br><span class="line">    <span class="type">int</span> minl,minlat;</span><br><span class="line">    <span class="type">int</span> maxr,maxrat;</span><br><span class="line">    <span class="type">int</span> minr,minrat;</span><br><span class="line">    <span class="type">int</span> maxv,maxvlat,maxvrat;</span><br><span class="line">    <span class="type">int</span> minv,minvlat,minvrat;</span><br><span class="line">    <span class="type">int</span> sum,l,r;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mul</span><span class="params">(<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(val==<span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="built_in">swap2</span>(maxl,minl);</span><br><span class="line">            <span class="built_in">swap2</span>(maxr,minr);</span><br><span class="line">            <span class="built_in">swap2</span>(maxv,minv);</span><br><span class="line">            <span class="built_in">swap</span>(maxlat,minlat);</span><br><span class="line">            <span class="built_in">swap</span>(maxrat,minrat);</span><br><span class="line">            <span class="built_in">swap</span>(maxvlat,minvlat);</span><br><span class="line">            <span class="built_in">swap</span>(maxvrat,minvrat);</span><br><span class="line">            sum*=<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cov</span><span class="params">(<span class="type">int</span> val)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(val&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            maxl=maxr=maxv=sum=val*(r-l+<span class="number">1</span>);</span><br><span class="line">            maxlat=maxvrat=r;</span><br><span class="line">            maxrat=maxvlat=l;</span><br><span class="line">            minl=minr=minv=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            minl=minr=minv=sum=val*(r-l+<span class="number">1</span>);</span><br><span class="line">            minlat=minvrat=r;</span><br><span class="line">            minrat=minvlat=l;</span><br><span class="line">            maxl=maxr=maxv=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> sub <span class="title">merge</span><span class="params">(<span class="type">const</span> sub&amp;a,<span class="type">const</span> sub&amp;b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a.l&gt;a.r) <span class="keyword">return</span> b;</span><br><span class="line">    sub res=a;</span><br><span class="line">    res.maxr=b.maxr;</span><br><span class="line">    res.minr=b.minr;</span><br><span class="line">    res.maxrat=b.maxrat;</span><br><span class="line">    res.minrat=b.minrat;</span><br><span class="line">    <span class="keyword">if</span>(res.maxl&lt;a.sum+b.maxl) res.maxl=a.sum+b.maxl,res.maxlat=b.maxlat;</span><br><span class="line">    <span class="keyword">if</span>(res.minl&gt;a.sum+b.minl) res.minl=a.sum+b.minl,res.minlat=b.minlat;</span><br><span class="line">    <span class="keyword">if</span>(res.maxr&lt;b.sum+a.maxr) res.maxr=b.sum+a.maxr,res.maxrat=a.maxrat;</span><br><span class="line">    <span class="keyword">if</span>(res.minr&gt;b.sum+a.minr) res.minr=b.sum+a.minr,res.minrat=a.minrat;</span><br><span class="line">    <span class="keyword">if</span>(res.maxv&lt;b.maxv) res.maxv=b.maxv,res.maxvlat=b.maxvlat,res.maxvrat=b.maxvrat;</span><br><span class="line">    <span class="keyword">if</span>(res.maxv&lt;a.maxr+b.maxl) res.maxv=a.maxr+b.maxl,res.maxvlat=a.maxrat,res.maxvrat=b.maxlat;</span><br><span class="line">    <span class="keyword">if</span>(res.minv&gt;b.minv) res.minv=b.minv,res.minvlat=b.minvlat,res.minvrat=b.minvrat;</span><br><span class="line">    <span class="keyword">if</span>(res.minv&gt;a.minr+b.minl) res.minv=a.minr+b.minl,res.minvlat=a.minrat,res.minvrat=b.minlat;</span><br><span class="line">    res.sum=a.sum+b.sum, res.l=a.l, res.r=b.r;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> ls[maxn*<span class="number">2</span>],rs[maxn*<span class="number">2</span>],cov[maxn*<span class="number">2</span>],mul[maxn*<span class="number">2</span>],a[maxn],tot;</span><br><span class="line">sub s[maxn*<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span>&amp;u)</span></span>&#123;s[u]=<span class="built_in">merge</span>(s[ls[u]],s[rs[u]]);&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span>&amp;u,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(cov[u]&lt;<span class="number">2e9</span>)&#123;</span><br><span class="line">        cov[ls[u]]=cov[rs[u]]=cov[u];</span><br><span class="line">        mul[ls[u]]=mul[rs[u]]=<span class="number">1</span>;</span><br><span class="line">        s[ls[u]].<span class="built_in">cov</span>(cov[u]);</span><br><span class="line">        s[rs[u]].<span class="built_in">cov</span>(cov[u]);</span><br><span class="line">        cov[u]=<span class="number">2e9</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(mul[u]==<span class="number">-1</span>) &#123;</span><br><span class="line">        mul[ls[u]]*=mul[u];</span><br><span class="line">        mul[rs[u]]*=mul[u];</span><br><span class="line">        s[ls[u]].<span class="built_in">mul</span>(mul[u]);</span><br><span class="line">        s[rs[u]].<span class="built_in">mul</span>(mul[u]);</span><br><span class="line">        mul[u]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span>&amp;u,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    u=++tot;</span><br><span class="line">    cov[u]=<span class="number">2e9</span>;</span><br><span class="line">    mul[u]=<span class="number">1</span>;</span><br><span class="line">    s[u].l=l;</span><br><span class="line">    s[u].r=r;</span><br><span class="line">    <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">        s[u].<span class="built_in">cov</span>(a[l]);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">build</span>(ls[u],l,ml);<span class="comment">// ls[u]</span></span><br><span class="line">    <span class="built_in">build</span>(rs[u],mr,r);<span class="comment">// rs[u]</span></span><br><span class="line">    <span class="built_in">pushup</span>(u);<span class="comment">// s[u]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span>&amp;u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr,<span class="type">int</span> d,<span class="type">int</span> flag)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=l&amp;&amp;r&lt;=qr)&#123;</span><br><span class="line">        <span class="keyword">if</span>(flag==<span class="number">0</span>) &#123;<span class="comment">//cover</span></span><br><span class="line">            cov[u]=d;</span><br><span class="line">            mul[u]=<span class="number">1</span>;</span><br><span class="line">            s[u].<span class="built_in">cov</span>(d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;<span class="comment">// multi</span></span><br><span class="line">            mul[u]*=d;</span><br><span class="line">            s[u].<span class="built_in">mul</span>(d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">pushdown</span>(u,l,r);</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=ml) <span class="built_in">update</span>(ls[u],l,ml,ql,qr,d,flag);</span><br><span class="line">    <span class="keyword">if</span>(mr&lt;=qr) <span class="built_in">update</span>(rs[u],mr,r,ql,qr,d,flag);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">sub <span class="title">query</span><span class="params">(<span class="type">int</span>&amp;u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=l&amp;&amp;r&lt;=qr) <span class="keyword">return</span> s[u];</span><br><span class="line">    <span class="built_in">pushdown</span>(u,l,r);</span><br><span class="line">    sub res; res.l=res.r+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=ml) res=<span class="built_in">merge</span>(res,<span class="built_in">query</span>(ls[u],l,ml,ql,qr));</span><br><span class="line">    <span class="keyword">if</span>(mr&lt;=qr) res=<span class="built_in">merge</span>(res,<span class="built_in">query</span>(rs[u],mr,r,ql,qr));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="built_in">rep</span>(i,<span class="number">1</span>,n) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;a[i]);</span><br><span class="line">    tot=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> rt; <span class="built_in">build</span>(rt,<span class="number">1</span>,n);</span><br><span class="line">    <span class="type">int</span> m;<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;m);</span><br><span class="line">    <span class="type">int</span> op,i,val,l,r,k;</span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;op);</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;i,&amp;val);</span><br><span class="line">            <span class="built_in">update</span>(rt,<span class="number">1</span>,n,i,i,val,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;l,&amp;r,&amp;k);</span><br><span class="line">            <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">            vector&lt;<span class="type">int</span>&gt;L,R;</span><br><span class="line">            <span class="keyword">while</span>(k--)&#123;</span><br><span class="line">                sub res=<span class="built_in">query</span>(rt,<span class="number">1</span>,n,l,r);</span><br><span class="line">                <span class="keyword">if</span>(res.maxv&lt;=<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">                ans+=res.maxv;</span><br><span class="line">                L.<span class="built_in">push_back</span>(res.maxvlat);</span><br><span class="line">                R.<span class="built_in">push_back</span>(res.maxvrat);</span><br><span class="line">                <span class="built_in">update</span>(rt,<span class="number">1</span>,n,L.<span class="built_in">back</span>(),R.<span class="built_in">back</span>(),<span class="number">-1</span>,<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(!L.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                <span class="built_in">update</span>(rt,<span class="number">1</span>,n,L.<span class="built_in">back</span>(),R.<span class="built_in">back</span>(),<span class="number">-1</span>,<span class="number">1</span>);</span><br><span class="line">                L.<span class="built_in">pop_back</span>();R.<span class="built_in">pop_back</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      </div>
        <div class="support-author">
          <p>感谢您的阅读。 🙏
          <a href="https://888.com/index.html" target="_blank">关于转载请看这里</a>
            <!--<a class="btn-pay"  href="#pay-modal">¥ 打赏支持</a>-->
          </p>
        </div>
        <!--
            <div class="like ">
              <div class="like-button">
                <a id="like-note" href="">
                  <i class="icon-heart"></i>喜欢
                </a>
              </div>
              <span id="likes-count">256</span>
            </div>
        -->
        <div class="otherLink">
          <div class="previous">
          </div>
          <div class="next">
          </div>
        </div>
        <div class="comments" id="comments">
          
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script type="text/javascript">
  const gitalk = new Gitalk({
    clientID: '8888a8888',
    clientSecret: '8888886666666',
    repo: 'xxxx.github.io',
    owner: 'admin',
    admin: ['admin'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false
  })

  gitalk.render('comments');
</script>


        </div>
      </div>
    </div>
   </div>
</main>
<div class="footer">
  <div class="info">
    <p>
    <a target="_blank" rel="noopener" href="https://hexo.io"> Hexo </a> 强力驱动 |
      <a target="_blank" rel="noopener" href="https://github.com/Youthink/hexo-themes-yearn"> Yearn </a>
      主题
    </p>
    <p>&copy;2013-2018 某某的博客 京ICP备xxxxxx号</p>
  </div>
</div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>//console
  var consoleConfig = '\n欢迎访问 https://hufangyun.com ，围观小猿大圣的博客(づ｡◕‿‿◕｡)づ！\n,\n本博客使用 %cHexo%c 搭建，博客主题为小猿大圣开发的 %chexo-themes-yearn%c ~~~ 🎉🎉🎉 \n\n源码 https://github.com/Youthink/hexo-themes-yearn \n\n如果喜欢可以 star 支持一下 ❤️~\n,\n扫描下面的二维码，在手机上查看博客！\n,https://static.hufangyun.com/blog-url-qrcode-180-180.png,\n 想知道这个效果如何实现的？博客内搜索 console 彩蛋 🚀 ！\n'.split(',');
  var canConsole = true;
  var consoleInfo = (function(consoleConfig) {
  if (!canConsole || !consoleConfig || consoleConfig.length < 1) {
    return;
  }
  var consoleColor = '#6190e8';
  var _console;
  var backgroundTextStyle = 'padding: 1px 5px;color: #fff;background: ' + consoleColor + ';'
  var textStyle = 'color: ' + consoleColor + ';';

  consoleConfig.map(o => {
    var num = (o.match(/%c/g) || []).length;
    if(/^http(s)?:\/\//.test(o)) {
      console.log('%c     ', 'background: url(' + o + ') no-repeat left center;font-size: 180px;');
      return;
    }
    if (num > 0) {
      var logArguments = [];
      for (var i = 0; i < num; i++) {
        if (i % 2 === 0) {
          logArguments.push(backgroundTextStyle);
        } else {
          logArguments.push(textStyle);
        }
      }
      (_console = console).log.apply(_console, ['%c' + o, textStyle].concat(logArguments));
      return;
    }
    console.log('%c' + o, textStyle);
  });
}(consoleConfig));</script><script type="text/javascript" src="/yearn/./js/main.js"></script>

  <script src="//at.alicdn.com/t/font_159214_mvtxvg9me9.js"></script>
</body>
</html>
