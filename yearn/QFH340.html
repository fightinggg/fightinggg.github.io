<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="keywords" content="hexo,ä¸ªäººåšå®¢,blog" />
  <meta name="description" content="æŸæŸçš„ä¸ªäººåšå®¢" />
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="dns-prefetch" href="https://busuanzi.ibruce.info">
  <link rel="dns-prefetch" href="https://at.alicdn.com">
  
  <link rel="dns-prefetch" href="https://widget.daovoice.io">
  <link rel="dns-prefetch" href="https://widget-static-cdn.daovoice.io">
  <link rel="dns-prefetch" href="https://im.daovoice.io">
  
  
  <link rel="dns-prefetch" href="https://hm.baidu.com/">
  
  
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://api.github.com">
  <link rel="dns-prefetch" href="https://avatars3.githubusercontent.com">
  
  <link rel="stylesheet" type="text/css" href="/yearn/./style/main.css">
	<link rel="shortcut icon" href="/favicon.ico" title="Favicon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
	<title>Hadoopå­¦ä¹ </title>
  
  <script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?awwssw1snsnsnn1ndndnndnd99j";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();
  </script>
  
  
    <script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/123456.js","daovoice");daovoice('init',{app_id: "123456"});daovoice('update');
  </script>
  
<meta name="generator" content="Hexo 6.3.0"></head>
<body>
  <canvas id="pattern-placeholder" height="230"></canvas>
<div class="navbar-header">
  <a class="blog-title" href="/yearn/">Believe it</a>
  <a class="face-img" href="/yearn/">
    <img src="https://tva3.sinaimg.cn/crop.0.0.200.200.180/005Kc3C1jw8f2uep0hhkvj305k05k3yk.jpg">
  </a>
</div>
<main>
  <div class="article-title">
    
  
  <h1 class="title">
    Hadoopå­¦ä¹ 
  </h1>
  


    <ul class="article-info">
      <li>
        å‘å¸ƒ
        <time datetime="2020-08-22T16:00:00.000Z" itemprop="datePublished">2020-08-23</time>
      </li>
      <li>
        
    æ›´æ–° <time datetime="2020-08-22T16:00:00.000Z" itemprop="dateUpdated">2020-08-23</time>

      </li>
      <li id="busuanzi_container_page_pv">
        é˜…è¯» <span id="busuanzi_value_page_pv"></span>
      </li>
    </ul>
  </div>
  <div class="container">
    <div class="article">
      <div class="content">
        
        <div><a href="/next/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">next</a><a href="/hexonext/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">hexonext</a><a href="/butterfly/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">butterfly</a><a href="/volantis/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">volantis</a><a href="/yearn/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">yearn</a><a href="/yilia/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">yilia</a><a href="/shoka/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">shoka</a><a href="/indigo/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">indigo</a><a href="/apollo/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">apollo</a><a href="/landscape/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">landscape</a><a href="/cactus/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">cactus</a><a href="/matery/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">matery</a><a href="/icarus/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">icarus</a><a href="/fluid/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">fluid</a><a href="/material/QFH340.html" style="border-bottom: 0px;border-bottom: 0px;
            background: #4FC921;
            color: white;
            border-radius: 5px;
            padding: 2px 6px 2px 6px;
            margin: 2px 6px 2px 6px;
            text-decoration: none;
            float: left;
            ">material</a><div style="clear: both;"></div></div>

<h2 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h2><span id="more"></span>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><h4 id="Docker-Install"><a href="#Docker-Install" class="headerlink" title="Docker Install"></a>Docker Install</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;===prepare workspace===&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;workspace&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;create new workspace&quot;</span></span><br><span class="line"><span class="built_in">mkdir</span> workspace</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">cd</span> workspace</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;===goto current space===&quot;</span></span><br><span class="line">version=$[$(<span class="built_in">ls</span> | <span class="built_in">sort</span> -n | <span class="built_in">tail</span> -n 1)+1]</span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$version</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$version</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Version: <span class="variable">$version</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Space: <span class="subst">$(pwd)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> ../../Dockerfile Dockerfile</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span>&gt;core-site.xml&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&lt;configuration&gt;</span></span><br><span class="line"><span class="string">    &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;fs.defaultFS&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;hdfs://localhost:9000&lt;/value&gt;</span></span><br><span class="line"><span class="string">    &lt;/property&gt;</span></span><br><span class="line"><span class="string">    &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;/data/hadoop&lt;/value&gt;</span></span><br><span class="line"><span class="string">    &lt;/property&gt;</span></span><br><span class="line"><span class="string">&lt;/configuration&gt;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span>&gt;mapred-site.xml&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&lt;configuration&gt;</span></span><br><span class="line"><span class="string">    &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;mapreduce.framework.name&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;yarn&lt;/value&gt;</span></span><br><span class="line"><span class="string">    &lt;/property&gt;</span></span><br><span class="line"><span class="string">    &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;mapreduce.application.classpath&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;\$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/*:\$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/lib/*&lt;/value&gt;</span></span><br><span class="line"><span class="string">    &lt;/property&gt;</span></span><br><span class="line"><span class="string">&lt;/configuration&gt;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span>&gt;yarn-site.xml&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&lt;configuration&gt;</span></span><br><span class="line"><span class="string">    &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</span></span><br><span class="line"><span class="string">    &lt;/property&gt;</span></span><br><span class="line"><span class="string">    &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;yarn.nodemanager.env-whitelist&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME&lt;/value&gt;</span></span><br><span class="line"><span class="string">    &lt;/property&gt;</span></span><br><span class="line"><span class="string">    &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;yarn.resourcemanager.address&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;localhost:8032&lt;/value&gt;</span></span><br><span class="line"><span class="string">      &lt;/property&gt;</span></span><br><span class="line"><span class="string">      &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;yarn.resourcemanager.scheduler.address&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;localhost:8030&lt;/value&gt;</span></span><br><span class="line"><span class="string">      &lt;/property&gt;</span></span><br><span class="line"><span class="string">      &lt;property&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;yarn.resourcemanager.resource-tracker.address&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;value&gt;localhost:8031&lt;/value&gt;</span></span><br><span class="line"><span class="string">      &lt;/property&gt;</span></span><br><span class="line"><span class="string">&lt;/configuration&gt;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span>&gt;entrypoint.sh&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">/usr/sbin/sshd</span></span><br><span class="line"><span class="string">if [ ! -d &quot;/data/hadoop&quot; ]; then</span></span><br><span class="line"><span class="string">hdfs namenode -format</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string">hdfs --daemon start datanode</span></span><br><span class="line"><span class="string">hdfs --daemon start namenode</span></span><br><span class="line"><span class="string">\$HADOOP_HOME/sbin/start-yarn.sh</span></span><br><span class="line"><span class="string">echo &quot;done!&quot;</span></span><br><span class="line"><span class="string">while true; do sleep 30; done;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">docker build -t hadoop:<span class="variable">$version</span> .</span><br><span class="line"></span><br><span class="line">docker <span class="built_in">rm</span> -f hadoop || <span class="literal">true</span></span><br><span class="line">docker run -idt --<span class="built_in">rm</span> \</span><br><span class="line">  -p 9870:9870 \</span><br><span class="line">  -p 8088:8088 \</span><br><span class="line">  -v /data/hadoop:/data \</span><br><span class="line">  --name hadoop \</span><br><span class="line">  hadoop:<span class="variable">$version</span></span><br><span class="line">docker logs hadoop -f</span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:centos8</span><br><span class="line"></span><br><span class="line"><span class="comment"># install ssh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> \</span></span><br><span class="line"><span class="language-bash">yum install openssh-server openssh-clients passwd  -y; \</span></span><br><span class="line"><span class="language-bash">sed -i <span class="string">&quot;s/^UsePAM yes/UsePAM no/g&quot;</span> /etc/ssh/sshd_config; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> 123456 | passwd root --stdin; \</span></span><br><span class="line"><span class="language-bash">ssh-keygen -t rsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_rsa; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">cat</span> ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys; \</span></span><br><span class="line"><span class="language-bash"><span class="built_in">chmod</span> 0600 ~/.ssh/authorized_keys; \</span></span><br><span class="line"><span class="language-bash">ssh-keygen -q -N <span class="string">&quot;&quot;</span> -t rsa -f /etc/ssh/ssh_host_rsa_key; \</span></span><br><span class="line"><span class="language-bash">ssh-keygen -q -N <span class="string">&quot;&quot;</span> -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key; \</span></span><br><span class="line"><span class="language-bash">ssh-keygen -q -N <span class="string">&quot;&quot;</span> -t ed25519 -f /etc/ssh/ssh_host_ed25519_key;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># install java</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> \</span></span><br><span class="line"><span class="language-bash">yum install wget -y; \</span></span><br><span class="line"><span class="language-bash">wget https://download.java.net/java/early_access/jdk16/27/GPL/openjdk-16-ea+27_linux-x64_bin.tar.gz ;\</span></span><br><span class="line"><span class="language-bash">tar -zxf openjdk-16-ea+27_linux-x64_bin.tar.gz -C /usr/local/; </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># env java</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/jdk-<span class="number">16</span></span><br><span class="line"><span class="keyword">ENV</span> PATH $PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># install hadoop</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> \</span></span><br><span class="line"><span class="language-bash">yum install wget -y; \</span></span><br><span class="line"><span class="language-bash">wget https://mirror.bit.edu.cn/apache/hadoop/common/hadoop-3.3.0/hadoop-3.3.0.tar.gz; \</span></span><br><span class="line"><span class="language-bash">tar -zxf hadoop-3.3.0.tar.gz -C /usr/local/; </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># env hadoop</span></span><br><span class="line"><span class="keyword">ENV</span> HADOOP_MAPRED_HOME /usr/local/hadoop-<span class="number">3.3</span>.<span class="number">0</span></span><br><span class="line"><span class="keyword">ENV</span> HADOOP_HOME /usr/local/hadoop-<span class="number">3.3</span>.<span class="number">0</span></span><br><span class="line"><span class="keyword">ENV</span> PATH $PATH:$HADOOP_HOME/bin</span><br><span class="line"><span class="keyword">ENV</span> HDFS_NAMENODE_USER root</span><br><span class="line"><span class="keyword">ENV</span> HDFS_DATANODE_USER root</span><br><span class="line"><span class="keyword">ENV</span> HDFS_SECONDARYNAMENODE_USER root</span><br><span class="line"><span class="keyword">ENV</span> YARN_RESOURCEMANAGER_USER root</span><br><span class="line"><span class="keyword">ENV</span> YARN_NODEMANAGER_USER root</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> \</span></span><br><span class="line"><span class="language-bash">sed <span class="string">&#x27;1 iexport JAVA_HOME=/usr/local/jdk-16&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">    -i <span class="variable">$HADOOP_HOME</span>/etc/hadoop/hadoop-env.sh; \</span></span><br><span class="line"><span class="language-bash">sed <span class="string">&#x27;1 iexport HADOOP_HOME=/usr/local/hadoop-3.3.0&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">    -i <span class="variable">$HADOOP_HOME</span>/etc/hadoop/hadoop-env.sh;</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> core-site.xml <span class="variable">$HADOOP_HOME</span>/etc/hadoop/core-site.xml</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> mapred-site.xml <span class="variable">$HADOOP_HOME</span>/etc/hadoop/mapred-site.xml</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> yarn-site.xml <span class="variable">$HADOOP_HOME</span>/etc/hadoop/yarn-site.xml</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> entrypoint.sh /entrypoint.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;/entrypoint.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h4 id="K8S-Install"><a href="#K8S-Install" class="headerlink" title="K8S Install"></a>K8S Install</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd</span> <span class="string">.</span></span><br><span class="line"><span class="string">mkdir</span> <span class="string">hadoop</span> <span class="string">||</span> <span class="literal">true</span></span><br><span class="line"><span class="string">cd</span> <span class="string">hadoop</span></span><br><span class="line"></span><br><span class="line"><span class="string">cat&gt;hadoop-deployment.yaml&lt;&lt;EOF</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hadoop-deployment</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">hadoop</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">hadoop</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">hadoop</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hadoop</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">sequenceiq/hadoop-docker:latest</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;/etc/bootstrap.sh&quot;</span>]</span><br><span class="line">        <span class="attr">args:</span> [<span class="string">&quot;-d&quot;</span>]</span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">50070</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="string">cat&gt;hadoop-service.yaml&lt;&lt;EOF</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hadoop-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">hadoop</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">50070</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">50070</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30000</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="string">hadoop-deployment.yaml</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="string">hadoop-service.yaml</span></span><br></pre></td></tr></table></figure>

<h3 id="Hadoopæ¦‚è¿°"><a href="#Hadoopæ¦‚è¿°" class="headerlink" title="Hadoopæ¦‚è¿°"></a>Hadoopæ¦‚è¿°</h3><h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><ul>
<li>é«˜å¯é </li>
<li>é«˜æ‹“å±•</li>
<li>é«˜æ•ˆæ€§</li>
<li>é«˜å®¹é”™</li>
</ul>
<h4 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h4><p>HDFSæ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…å«NameNode, DataNodeå’ŒSecondary NameNode</p>
<table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>NameNode</td>
<td>å‚¨å­˜æ–‡ä»¶çš„å…ƒæ•°æ®</td>
</tr>
<tr>
<td>DataNode</td>
<td>å‚¨å­˜æ–‡ä»¶å—ï¼Œæ ¡éªŒå’Œ</td>
</tr>
<tr>
<td>Secondary NameNode</td>
<td>ååŠ©NameNodeå¤„ç†å…ƒæ•°æ®</td>
</tr>
</tbody></table>
<h4 id="YARN"><a href="#YARN" class="headerlink" title="YARN"></a>YARN</h4><p>YARNæ˜¯åˆ†å¸ƒå¼èµ„æºè°ƒåº¦å™¨ï¼ŒåŒ…å«äº†ResourceManager, NodeManager, ApplicationMaster, Container</p>
<table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>ResourceManager</td>
<td>å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œç›‘æ§NodeManager, å¯åŠ¨ApplicationMaster, åˆ†é…å’Œè°ƒåº¦èµ„æº</td>
</tr>
<tr>
<td>NodeManager</td>
<td>ç®¡ç†å•ä¸ªèŠ‚ç‚¹ä¸Šçš„èµ„æºï¼Œå¤„ç†ResourceManagerå’ŒApplicationMasterçš„å‘½ä»¤</td>
</tr>
<tr>
<td>ApplicationMaster</td>
<td>åˆ‡åˆ†æ•°æ®ï¼Œä¸ºåº”ç”¨ç¨‹åºç”³è¯·èµ„æºï¼Œå¹¶åˆ†é…ç»™ä»»åŠ¡ï¼Œå¤„ç†ä»»åŠ¡çš„ç›‘æ§å’Œå®¹é”™</td>
</tr>
<tr>
<td>Container</td>
<td>ä»£è¡¨èŠ‚ç‚¹çš„CPU,å†…å­˜ï¼Œç£ç›˜ï¼Œç½‘ç»œ</td>
</tr>
</tbody></table>
<h4 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h4><p>MapReduceæ˜¯ä¸€ä¸ªè®¡ç®—æ¨¡å‹ï¼Œ Mapé˜¶æ®µå¹¶è¡Œå¤„ç†æ•°æ®ï¼ŒReduceé˜¶æ®µå¯¹Mapæ±‡æ€»</p>
<h3 id="HDFS-1"><a href="#HDFS-1" class="headerlink" title="HDFS"></a>HDFS</h3><p>HDFSå…¨ç§°ä¸ºHadoop Distributed File System,é€‚ç”¨äºä¸€æ¬¡å†™å…¥ï¼Œå¤šæ¬¡è¯»å‡ºï¼Œä¸æ”¯æŒä¿®æ”¹</p>
<h4 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h4><p>æ–‡ä»¶åˆ†å—å­˜å‚¨ï¼Œé»˜è®¤æ˜¯128Mï¼Œblockçš„å¯»å€æ—¶é—´ä¸€èˆ¬ä¸º10msï¼Œå¯»å€æ—¶é—´ä¸ºä¼ è¾“æ—¶é—´çš„1%çš„æ—¶å€™ï¼Œè¾¾åˆ°æœ€ä½³çŠ¶æ€ï¼Œæœºæ¢°ç¡¬ç›˜çš„é€Ÿç‡æ˜¯100M&#x2F;s, æ‰€ä»¥æ–‡ä»¶åˆ†å—çš„å¤§å°ä¸º100M è¾ƒä½³ï¼Œè¿‘ä¼¼åˆ°128M.<br>$$<br>10ms &#x2F; 1% \to 1s\<br>1s &#x2F; 100MB&#x2F;s \to 100MB \<br>100MB \to 128MB<br>$$</p>
<p>blockå¤ªå°å¢åŠ å¯»å€æ—¶é—´ï¼Œå¤ªå¤§ä¼šå¯¼è‡´æ•°æ®ä¼ è¾“çš„æ—¶é—´è¿‡é•¿ï¼Œæ‰€ä»¥blockçš„å¤§å°å–å†³äºç£ç›˜çš„ä¼ è¾“é€Ÿç‡</p>
<h4 id="HDFS-shell"><a href="#HDFS-shell" class="headerlink" title="HDFS shell"></a>HDFS shell</h4><p><a target="_blank" rel="noopener" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/FileSystemShell.html">https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/FileSystemShell.html</a></p>
<h4 id="HDFSè¯»å†™æ–‡ä»¶"><a href="#HDFSè¯»å†™æ–‡ä»¶" class="headerlink" title="HDFSè¯»å†™æ–‡ä»¶"></a>HDFSè¯»å†™æ–‡ä»¶</h4><p><img src='/image-2020-12-15-14.21.56.156.png'></img></p>
<p><img src='/image-2020-12-15-14.22.42.967.png'></img></p>
<h4 id="NameNodeå·¥ä½œæœºåˆ¶"><a href="#NameNodeå·¥ä½œæœºåˆ¶" class="headerlink" title="NameNodeå·¥ä½œæœºåˆ¶"></a>NameNodeå·¥ä½œæœºåˆ¶</h4><p>NameNodeå°†å†…å­˜æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œåˆ†ä¸ºfsimageå’Œeditsä¸¤ä¸ªæ–‡ä»¶ï¼Œfsimageæ˜¯è€çš„å†…å­˜é•œåƒï¼Œeditsæ˜¯è¿½åŠ æ ¼å¼çš„æ—¥å¿—ï¼Œè¡¨ç¤ºç€å†…å­˜çš„å˜åŒ–æƒ…å†µï¼Œéšç€NameNodeå·¥ä½œï¼Œeditsä¼šè¶Šæ¥è¶Šå¤§ï¼Œè¿™æ—¶å€™SecondaryNameNodeä¼šååŠ©NameNodeå°†editsä¸fsimageåˆå¹¶ä¸ºæ–°çš„fsimageã€‚ æ³¨æ„ä¸‹å›¾ç´«è‰²éƒ¨åˆ†çš„æµç¨‹å³å¯</p>
<p><img src='/image-2020-12-15-14.30.55.795.png'></img></p>
<h4 id="é›†ç¾¤å®‰å…¨æ¨¡å¼"><a href="#é›†ç¾¤å®‰å…¨æ¨¡å¼" class="headerlink" title="é›†ç¾¤å®‰å…¨æ¨¡å¼"></a>é›†ç¾¤å®‰å…¨æ¨¡å¼</h4><p>å½“NameNodeä¸æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåŠ è½½Fsimageï¼Œå¹¶æ‰§è¡ŒEditsæ—¥å¿—ï¼Œæœ€ååˆå¹¶ï¼Œæ­¤åå¼€å§‹ç›‘å¬DataNodeè¯·æ±‚ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­NameNodeä¸€ç›´æ˜¯å®‰å…¨æ¨¡å¼ï¼Œæ–‡ä»¶ç³»ç»Ÿå¤„äºåªè¯»çŠ¶æ€ï¼Œå¦‚æœæ»¡è¶³æœ€å°å‰¯æœ¬æ•°ï¼ŒNameNodeä¼šåœ¨30ç§’åé€€å‡ºå®‰å…¨æ¨¡å¼</p>
<h4 id="NameNodeå¤šç›®å½•é…ç½®"><a href="#NameNodeå¤šç›®å½•é…ç½®" class="headerlink" title="NameNodeå¤šç›®å½•é…ç½®"></a>NameNodeå¤šç›®å½•é…ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>file:///xxx,file:///xxx<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬é…ç½®äº†å¤šä¸ªç›®å½•ä»¥åï¼Œ NameNodeçš„æ•°æ®ä¼šåŒæ—¶å­˜å‚¨åœ¨è¿™äº›ç›®å½•ä¸­ï¼Œè¿™äº›ç›®å½•ä¸­çš„å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä¸€ä¸ªç›®å½•æŸåï¼ŒNameNodeä¼šé€šè¿‡å¦ä¸€ä¸ªç›®å½•æ¢å¤</p>
<h4 id="DataNodeå·¥ä½œæœºåˆ¶"><a href="#DataNodeå·¥ä½œæœºåˆ¶" class="headerlink" title="DataNodeå·¥ä½œæœºåˆ¶"></a>DataNodeå·¥ä½œæœºåˆ¶</h4><p><img src='/image-2020-12-16-09.38.31.785.png'></img></p>
<p>è¶…æ—¶æ—¶é—´æ˜¯2 * dfs.namenode.heartbeat.recheck-interval + 10 * dfs.hertbeat.interval</p>
<h3 id="MapReduce-1"><a href="#MapReduce-1" class="headerlink" title="MapReduce"></a>MapReduce</h3><h4 id="å…¨è¿‡ç¨‹"><a href="#å…¨è¿‡ç¨‹" class="headerlink" title="å…¨è¿‡ç¨‹"></a>å…¨è¿‡ç¨‹</h4><p>(input) <code>&lt;k1, v1&gt; -&gt;</code> <strong>map</strong> <code>-&gt; &lt;k2, v2&gt; -&gt;</code> <strong>combine</strong> <code>-&gt; &lt;k2, v2&gt; -&gt;</code> <strong>reduce</strong> <code>-&gt; &lt;k3, v3&gt;</code> (output)</p>
<h5 id="InputFormat"><a href="#InputFormat" class="headerlink" title="InputFormat"></a>InputFormat</h5><p>InputFormatæ˜¯æ‰§è¡ŒMapReduceçš„ç¬¬ä¸€æ­¥ï¼Œä»–ä¸»è¦ç”¨äºåœ¨ä»HDFSæ–‡ä»¶ç³»ç»Ÿè¾“å…¥åˆ°MapTaskçš„è¿‡ç¨‹</p>
<table>
<thead>
<tr>
<th>åè¯</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>æ•°æ®å—</td>
<td>Blockæ˜¯HDFSç‰©ç†ä¸ŠæŠŠæ•°æ®åˆ†æˆçš„å¤šå—</td>
</tr>
<tr>
<td>æ•°æ®åˆ‡ç‰‡</td>
<td>Splitæ˜¯é€»è¾‘ä¸Šå¯¹æ•°æ®çš„åˆ†ç‰‡ï¼Œæ¯ä¸ªSplitç”±ä¸€ä¸ªMapTaskå¤„ç†</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>åˆ‡ç‰‡æ–¹æ³•</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>TextInputFormat</td>
<td>æŒ‰ç…§å¤§å°åˆ‡ç‰‡ï¼Œkvåˆ†åˆ«æ˜¯è¡Œåç§»é‡å’Œè¡Œçš„å…·ä½“æ•°æ®</td>
</tr>
<tr>
<td>KeyValueTextInputFormat</td>
<td>æŒ‰ç…§å¤§å°åˆ‡ç‰‡ï¼Œkvæ˜¯æ¯ä¸€è¡Œç”±åˆ†éš”ç¬¦åˆ†å‰²çš„å·¦å³ä¸¤éƒ¨åˆ†</td>
</tr>
<tr>
<td>NLineInputFormat</td>
<td>æŒ‰ç…§è¡Œæ•°åˆ‡ç‰‡ï¼Œkvåˆ†åˆ«æ˜¯è¡Œåç§»é‡å’Œè¡Œçš„å…·ä½“æ•°æ®</td>
</tr>
<tr>
<td>CombineTextInputFormat</td>
<td>æŒ‰ç…§å¤§å°æ‹†åˆ†å¤§æ–‡ä»¶ï¼Œåˆå¹¶å°æ–‡ä»¶ï¼Œkvåˆ†åˆ«æ˜¯è¡Œåç§»é‡å’Œè¡Œçš„å…·ä½“æ•°æ®</td>
</tr>
</tbody></table>
<h5 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h5><p> å½“ç»è¿‡äº†InputFormatä»¥åï¼Œæ•°æ®å°±è¿›å…¥åˆ°äº†Mapé˜¶æ®µï¼Œ</p>
<p>åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒMapæ¡†æ¶ä¼šå¯¹æ¯ä¸€å¯¹KVè¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œå¹¶è¾“å‡ºä¸ºæ–°çš„KVï¼Œ</p>
<p>æŠŠæ–°çš„KVå†™å…¥ç¯å½¢ç¼“å†²åŒºï¼Œä¸€ç«¯å†™ç´¢å¼•ï¼Œå¦ä¸€ç«¯å†™æ•°æ®ï¼Œ</p>
<p>ç›´åˆ°ç¯å½¢ç¼“å†²åŒºè¾¾åˆ°80%(80MB)ï¼ŒMapæ¡†æ¶å°†ç¼“å†²åŒºæ•°æ®æ’åºå¹¶å†™å…¥ç£ç›˜æ–‡ä»¶è¿›è¡Œåˆ†åŒº</p>
<p>ç›´åˆ°æ–‡ä»¶æ•°é‡è¾¾åˆ°ä¸€å®šä¸Šé™ï¼ŒMapæ¡†æ¶å°†æ–‡ä»¶æ’åºåˆå¹¶ï¼Œå¹¶è¿›è¡Œåˆ†åŒº</p>
<p><img src='/image-2020-12-16-09.55.59.712.png'></img></p>
<h5 id="Partition"><a href="#Partition" class="headerlink" title="Partition"></a>Partition</h5><p>Mapåï¼Œéœ€è¦å°†æ•°æ®å†™å…¥ä¸åŒçš„åˆ†åŒºï¼Œ</p>
<ul>
<li><p>ReduceTaskæ•°å¤§äºåˆ†åŒºæ•°ï¼Œåˆ™æœ€åå‡ ä¸ªReduceä¸ºç©º</p>
</li>
<li><p>ReduceTaskå°äºåˆ†åŒºæ•°å¤§äº1ï¼Œåˆ™å¼‚å¸¸</p>
</li>
<li><p>ReduceTask&#x3D;1ï¼Œåˆ™åªæœ‰ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶</p>
</li>
</ul>
<p>é»˜è®¤çš„åˆ†åŒºæ˜¯HashPartitioner</p>
<h6 id="MapReduceä¸­çš„æ’åº"><a href="#MapReduceä¸­çš„æ’åº" class="headerlink" title="MapReduceä¸­çš„æ’åº"></a>MapReduceä¸­çš„æ’åº</h6><p>MapReduceä¸¤ä¸ªé˜¶æ®µéƒ½ä¼šè¿›è¡Œæ’åºï¼Œä¸ç®¡å®é™…æ˜¯å¦éœ€è¦</p>
<ul>
<li>Mapï¼š ç¯å½¢ç¼“å†²åŒº -&gt; è¾¾åˆ°80% -&gt; å¿«æ’ -&gt; å†™å…¥æ–‡ä»¶ -&gt; Mapå®Œæˆ -&gt; æ‰€æœ‰æ–‡ä»¶å½’å¹¶æ’åº</li>
<li>Reduceï¼š è¿œç¨‹æ‹·è´æ–‡ä»¶åˆ°å†…å­˜-&gt; è¾¾åˆ°å†…å­˜é˜ˆå€¼-&gt; å†™å…¥ä¸€ä¸ªç£ç›˜æ–‡ä»¶-&gt; ç£ç›˜æ–‡ä»¶ä¸ªæ•°è¾¾åˆ°é˜ˆå€¼-&gt; åˆå¹¶æ–‡ä»¶ -&gt;  æ‹·è´å®Œæˆ-&gt;  æ‰€æœ‰æ•°æ®(ç£ç›˜+å†…å­˜)å½’å¹¶æ’åº</li>
</ul>
<h6 id="æ’åºçš„æ–¹æ³•"><a href="#æ’åºçš„æ–¹æ³•" class="headerlink" title="æ’åºçš„æ–¹æ³•"></a>æ’åºçš„æ–¹æ³•</h6><ul>
<li>éƒ¨åˆ†æ’åºï¼š è¾“å‡ºæ˜¯å¤šä¸ªæ–‡ä»¶ï¼Œä¿è¯æ¯ä¸ªæ–‡ä»¶æœ‰åº</li>
<li>å…¨æ’åºï¼š è¾“å‡ºæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¿è¯è¿™ä¸ªæ–‡ä»¶æœ‰åº</li>
<li>è¾…åŠ©æ’åºï¼š </li>
<li>äºŒæ¬¡æ’åºï¼š æ’åºä¸­æœ‰ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶</li>
</ul>
<h6 id="å¦‚ä½•æ’åº"><a href="#å¦‚ä½•æ’åº" class="headerlink" title="å¦‚ä½•æ’åº"></a>å¦‚ä½•æ’åº</h6><p>å®ç°WriteableCompableæ¥å£å³å¯</p>
<h5 id="Combiner"><a href="#Combiner" class="headerlink" title="Combiner"></a>Combiner</h5><p>Combinerå°±æ˜¯ä¸€ä¸ªå±€éƒ¨çš„Reduceï¼Œä»–ä¸ä¸€å®šå¿…è¦ï¼Œå¹¶ä¸é€šç”¨äºæ‰€æœ‰çš„MRç¨‹åºï¼Œæ¯”å¦‚æ±‚å¹³å‡å€¼ï¼Œä½†æ˜¯åœ¨å±€éƒ¨Reduceä¸å½±å“å…¨å±€Reduceçš„æƒ…å†µä¸‹å®ƒå¯ä»¥é™ä½ç½‘ç»œä¼ è¾“å‹åŠ›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.setCombinerClass(IntSumReducer.class);</span><br></pre></td></tr></table></figure>

<h5 id="Shuffle"><a href="#Shuffle" class="headerlink" title="Shuffle"></a>Shuffle</h5><p>å¾€å¾€æˆ‘ä»¬ç§°Mapä¹‹åï¼ŒReduceä¹‹å‰çš„æ“ä½œä¸ºShuffle</p>
<h5 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h5><p><img src='/image-2020-12-16-13.29.01.786.png'></img></p>
<h5 id="OutputFormat"><a href="#OutputFormat" class="headerlink" title="OutputFormat"></a>OutputFormat</h5><table>
<thead>
<tr>
<th>OUTPUTFORMAT</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>TextOutputFormat</td>
<td>æŠŠç»“æœå†™æˆæ–‡æœ¬è¡Œ</td>
</tr>
<tr>
<td>SequenceFileOutputFormat</td>
<td>å†™æˆäºŒè¿›åˆ¶æ–‡ä»¶</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="Join"><a href="#Join" class="headerlink" title="Join"></a>Join</h4><p>åœ¨Reduceç«¯Joinï¼š ç”¨åŒä¸€ä¸ªkeyå³å¯</p>
<p>åœ¨Mapç«¯Joinï¼š ç”¨å­—å…¸æ‰‹åŠ¨Join</p>
<h4 id="Compress"><a href="#Compress" class="headerlink" title="Compress"></a>Compress</h4><p>æ”¯æŒgzip,bzip,Lzoç­‰å‹ç¼©æ–¹å¼ï¼Œå¯ä»¥ç”¨äºè¾“å…¥æ–‡ä»¶çš„è§£å‹ç¼©ï¼Œè¾“å‡ºæ–‡ä»¶çš„å‹ç¼©ï¼Œmapreduceä¸­é—´æ–‡ä»¶çš„å‹ç¼©</p>
<p>Mapç«¯å‹ç¼©</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configuration.setBoolean(<span class="string">&quot;mapreduce.map.output.compress&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">configuration.setClass(<span class="string">&quot;mapreduce.map.output.compress.codec&quot;</span>,</span><br><span class="line">                          BZip2Codec.class, CompressionCodec.class)</span><br></pre></td></tr></table></figure>

<p>Reduceå‹ç¼©</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FileOutputFormat.setCompressOutput(job,<span class="literal">true</span>);</span><br><span class="line">FileOutputormat.setOutputCompressorClass(job,GzipCodec.class);</span><br></pre></td></tr></table></figure>

<h4 id="MRé€Ÿåº¦æ…¢çš„åŸå› "><a href="#MRé€Ÿåº¦æ…¢çš„åŸå› " class="headerlink" title="MRé€Ÿåº¦æ…¢çš„åŸå› "></a>MRé€Ÿåº¦æ…¢çš„åŸå› </h4><p>è®¡ç®—æœºæ€§èƒ½ï¼š CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ</p>
<p>IO: æ•°æ®å€¾æ–œï¼Œå°æ–‡ä»¶å¤šï¼Œä¸å¯åˆ†å—çš„è¶…å¤§æ–‡ä»¶å¤šï¼Œspillæ¬¡æ•°å¤šï¼Œmergeæ¬¡æ•°å¤š</p>
<h5 id="MRä¼˜åŒ–"><a href="#MRä¼˜åŒ–" class="headerlink" title="MRä¼˜åŒ–"></a>MRä¼˜åŒ–</h5><ul>
<li>è¾“å…¥é˜¶æ®µï¼šåˆå¹¶å°æ–‡ä»¶</li>
<li>Maperé˜¶æ®µï¼šè°ƒæ•´ç¯å½¢ç¼“å†²åŒºå¤§å°å’Œæº¢å†™æ¯”ä¾‹</li>
<li>Maperé˜¶æ®µï¼šè°ƒæ•´åˆå¹¶æ–‡ä»¶çš„æ–‡ä»¶ä¸ªæ•°é˜ˆå€¼</li>
<li>Maperé˜¶æ®µï¼šä½¿ç”¨Combiner</li>
<li>Reduceé˜¶æ®µï¼šåˆç†è®¾ç½®Map Reduceä¸ªæ•°</li>
<li>Reduceé˜¶æ®µï¼šè°ƒæ•´slowstart.completedmaps,æå‰ç”³è¯·Reduceèµ„æº</li>
<li>Reduceé˜¶æ®µï¼šMapTaskæœºå™¨æ–‡ä»¶ -&gt; ReduceTaskæœºå™¨Buffer -&gt; ç£ç›˜ -&gt; Reduce,  è°ƒæ•´Bufferï¼Œè®©Bufferä¸­ä¿ç•™ä¸€å®šçš„æ•°æ®ï¼Œç›´æ¥ä¼ ç»™Reduce</li>
<li>å‹ç¼©æ•°æ®</li>
<li>å¼€å¯JVMé‡ç”¨</li>
</ul>
<h3 id="Yarn"><a href="#Yarn" class="headerlink" title="Yarn"></a>Yarn</h3><h4 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h4><p><img src='/image-2020-12-16-13.43.36.961.png'></img></p>
<h4 id="è°ƒåº¦å™¨"><a href="#è°ƒåº¦å™¨" class="headerlink" title="è°ƒåº¦å™¨"></a>è°ƒåº¦å™¨</h4><ul>
<li>FIFIOè°ƒåº¦å™¨ï¼š å…ˆè¿›å…ˆå‡º</li>
<li>å®¹é‡è°ƒåº¦å™¨ï¼ˆé»˜è®¤ï¼‰ï¼šæ”¯æŒå¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ— æœ‰ä¸€å®šçš„èµ„æºï¼Œå„è‡ªé‡‡ç”¨FIFOï¼Œå¯¹åŒä¸€ä¸ªç”¨æˆ·çš„ä½œä¸šæ‰€å èµ„æºè¿›è¡Œé™åˆ¶ï¼Œå®‰è£…ä»»åŠ¡å’Œèµ„æºæ¯”ä¾‹åˆ†é…æ–°çš„ä»»åŠ¡ï¼ŒæŒ‰ç…§ä»»åŠ¡ä¼˜å…ˆçº§ã€æäº¤æ—¶é—´ã€ç”¨æˆ·çš„èµ„æºé™åˆ¶ã€å†…å­˜é™åˆ¶å¯¹é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ’åº</li>
<li>å…¬å¹³è°ƒåº¦å™¨ï¼ˆå¹¶å‘åº¦éå¸¸é«˜ï¼‰ï¼š å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¸­çš„jobå¯ä»¥å¹¶å‘è¿è¡Œï¼Œå¯ä»¥æ¯ä¸ªjobéƒ½æœ‰èµ„æºï¼Œå“ªä¸ªjobè¿˜ç¼ºçš„èµ„æºæœ€å¤šï¼Œå°±ç»™å“ªä¸ªjobåˆ†é…èµ„æº</li>
</ul>
<h4 id="ä»»åŠ¡æ¨æµ‹æ‰§è¡Œ"><a href="#ä»»åŠ¡æ¨æµ‹æ‰§è¡Œ" class="headerlink" title="ä»»åŠ¡æ¨æµ‹æ‰§è¡Œ"></a>ä»»åŠ¡æ¨æµ‹æ‰§è¡Œ</h4><p>å½“å‰Jobå·²å®Œæˆçš„Taskè¾¾åˆ°5%ï¼Œ ä¸”æŸä»»åŠ¡æ‰§è¡Œè¾ƒæ…¢ï¼Œåˆ™å¼€å§‹å¤‡ä»½ä»»åŠ¡<br>$$<br>å½“å‰ä»»åŠ¡å®Œæˆæ—¶åˆ» &#x3D; å½“å‰æ—¶åˆ» +ï¼ˆå½“å‰æ—¶åˆ» - ä»»åŠ¡å¼€å§‹æ—¶åˆ»ï¼‰&#x2F; ä»»åŠ¡è¿è¡Œè¿›åº¦\<br>å¤‡ä»½ä»»åŠ¡å®Œæˆæ—¶åˆ» &#x3D; å½“å‰æ—¶åˆ» + æ‰€æœ‰ä»»åŠ¡å¹³å‡èŠ±è´¹æ—¶é—´<br>$$<br>æ¯ä¸ªä»»åŠ¡æœ€å¤šä¸€ä¸ªå¤‡ä»½ä»»åŠ¡ï¼Œæ¯ä¸ªä½œä¸šä¹Ÿæœ‰å¤‡ä»½ä»»åŠ¡ä¸Šé™</p>
<h3 id="HA"><a href="#HA" class="headerlink" title="HA"></a>HA</h3><h4 id="HDFS-HA"><a href="#HDFS-HA" class="headerlink" title="HDFS HA"></a>HDFS HA</h4><h4 id="YARN-HA"><a href="#YARN-HA" class="headerlink" title="YARN HA"></a>YARN HA</h4>
      </div>
        <div class="support-author">
          <p>æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚ ğŸ™
          <a href="https://888.com/index.html" target="_blank">å…³äºè½¬è½½è¯·çœ‹è¿™é‡Œ</a>
            <!--<a class="btn-pay"  href="#pay-modal">Â¥ æ‰“èµæ”¯æŒ</a>-->
          </p>
        </div>
        <!--
            <div class="like ">
              <div class="like-button">
                <a id="like-note" href="">
                  <i class="icon-heart"></i>å–œæ¬¢
                </a>
              </div>
              <span id="likes-count">256</span>
            </div>
        -->
        <div class="otherLink">
          <div class="previous">
          </div>
          <div class="next">
          </div>
        </div>
        <div class="comments" id="comments">
          
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script type="text/javascript">
  const gitalk = new Gitalk({
    clientID: '8888a8888',
    clientSecret: '8888886666666',
    repo: 'xxxx.github.io',
    owner: 'admin',
    admin: ['admin'],
    id: location.pathname,      // Ensure uniqueness and length less than 50
    distractionFreeMode: false
  })

  gitalk.render('comments');
</script>


        </div>
      </div>
    </div>
   </div>
</main>
<div class="footer">
  <div class="info">
    <p>
    <a target="_blank" rel="noopener" href="https://hexo.io"> Hexo </a> å¼ºåŠ›é©±åŠ¨ |
      <a target="_blank" rel="noopener" href="https://github.com/Youthink/hexo-themes-yearn"> Yearn </a>
      ä¸»é¢˜
    </p>
    <p>&copy;2013-2018 æŸæŸçš„åšå®¢ äº¬ICPå¤‡xxxxxxå·</p>
  </div>
</div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>//console
  var consoleConfig = '\næ¬¢è¿è®¿é—® https://hufangyun.com ï¼Œå›´è§‚å°çŒ¿å¤§åœ£çš„åšå®¢(ã¥ï½¡â—•â€¿â€¿â—•ï½¡)ã¥ï¼\n,\næœ¬åšå®¢ä½¿ç”¨ %cHexo%c æ­å»ºï¼Œåšå®¢ä¸»é¢˜ä¸ºå°çŒ¿å¤§åœ£å¼€å‘çš„ %chexo-themes-yearn%c ~~~ ğŸ‰ğŸ‰ğŸ‰ \n\næºç  https://github.com/Youthink/hexo-themes-yearn \n\nå¦‚æœå–œæ¬¢å¯ä»¥ star æ”¯æŒä¸€ä¸‹ â¤ï¸~\n,\næ‰«æä¸‹é¢çš„äºŒç»´ç ï¼Œåœ¨æ‰‹æœºä¸ŠæŸ¥çœ‹åšå®¢ï¼\n,https://static.hufangyun.com/blog-url-qrcode-180-180.png,\n æƒ³çŸ¥é“è¿™ä¸ªæ•ˆæœå¦‚ä½•å®ç°çš„ï¼Ÿåšå®¢å†…æœç´¢ console å½©è›‹ ğŸš€ ï¼\n'.split(',');
  var canConsole = true;
  var consoleInfo = (function(consoleConfig) {
  if (!canConsole || !consoleConfig || consoleConfig.length < 1) {
    return;
  }
  var consoleColor = '#6190e8';
  var _console;
  var backgroundTextStyle = 'padding: 1px 5px;color: #fff;background: ' + consoleColor + ';'
  var textStyle = 'color: ' + consoleColor + ';';

  consoleConfig.map(o => {
    var num = (o.match(/%c/g) || []).length;
    if(/^http(s)?:\/\//.test(o)) {
      console.log('%c     ', 'background: url(' + o + ') no-repeat left center;font-size: 180px;');
      return;
    }
    if (num > 0) {
      var logArguments = [];
      for (var i = 0; i < num; i++) {
        if (i % 2 === 0) {
          logArguments.push(backgroundTextStyle);
        } else {
          logArguments.push(textStyle);
        }
      }
      (_console = console).log.apply(_console, ['%c' + o, textStyle].concat(logArguments));
      return;
    }
    console.log('%c' + o, textStyle);
  });
}(consoleConfig));</script><script type="text/javascript" src="/yearn/./js/main.js"></script>

  <script src="//at.alicdn.com/t/font_159214_mvtxvg9me9.js"></script>
</body>
</html>
